# Aegis Linux - ClamAV Daemon Configuration
# =============================================================================
# Real-time malware scanning with on-access protection
# =============================================================================

# Socket configuration
LocalSocket /run/clamav/clamd.ctl
LocalSocketGroup clamav
LocalSocketMode 660

# User and group
User clamav

# Database directory
DatabaseDirectory /var/lib/clamav

# Logging
LogFile /var/log/clamav/clamd.log
LogFileMaxSize 2M
LogTime yes
LogSyslog yes
LogRotate yes

# Temporary directory
TemporaryDirectory /var/tmp

# =============================================================================
# Scanning Options
# =============================================================================

# Archive scanning
ScanArchive yes
ArchiveBlockEncrypted no
MaxScanSize 100M
MaxFileSize 25M
MaxRecursion 16
MaxFiles 10000

# Document scanning
ScanOLE2 yes
ScanPDF yes
ScanSWF yes
ScanXMLDOCS yes
ScanHWP3 yes

# Mail scanning
ScanMail yes
ScanPartialMessages yes
PhishingSignatures yes
PhishingScanURLs yes

# HTML scanning
ScanHTML yes

# Executable scanning
ScanPE yes
ScanELF yes
DetectBrokenExecutables yes

# Other options
HeuristicAlerts yes
HeuristicScanPrecedence yes
StructuredDataDetection no
AlertExceedsMax yes

# =============================================================================
# On-Access Scanning Configuration
# =============================================================================

# Enable on-access scanning
OnAccessMountPath /home
OnAccessMountPath /tmp
OnAccessMountPath /var/tmp

# Prevention mode - blocks access to infected files
# Set to 'yes' for active blocking (impacts performance)
OnAccessPrevention yes

# Extra scanning on new file creation/modification
OnAccessExtraScanning yes

# Exclude high-I/O directories
OnAccessExcludePath /proc
OnAccessExcludePath /sys
OnAccessExcludePath /dev
OnAccessExcludePath /run
OnAccessExcludePath /var/cache
OnAccessExcludePath /var/lib/docker
OnAccessExcludePath /home/*/.cache
OnAccessExcludePath /home/*/.local/share/Trash

# Exclude the ClamAV database directory (prevents loops)
OnAccessExcludePath /var/lib/clamav

# User to exclude from on-access scanning (clamav user)
OnAccessExcludeUname clamav

# Max file size for on-access scanning (larger files scanned on-demand)
OnAccessMaxFileSize 25M

# Retry settings
OnAccessRetryAttempts 3
OnAccessDenyOnError no

# =============================================================================
# Quarantine Configuration
# =============================================================================

# Note: Quarantine is handled by scan commands, not clamd itself
# Use: clamdscan --move=/var/lib/clamav/quarantine <path>

# =============================================================================
# Performance Tuning
# =============================================================================

# Number of threads
MaxThreads 4

# Queue size
MaxQueue 100

# Idle timeout
IdleTimeout 30

# Send timeout
SendBufTimeout 200

# Read timeout
ReadTimeout 180

# Command timeout
CommandReadTimeout 30

# Self-check interval (seconds)
SelfCheck 3600

# Preload database into memory
ConcurrentDatabaseReload yes

# Bytecode support
Bytecode yes
BytecodeSecurity TrustSigned
BytecodeTimeout 60000

# =============================================================================
# Alerting
# =============================================================================

# Extended detection info
ExtendedDetectionInfo yes

# Alert on broken executables
AlertBrokenExecutables yes

# Alert on encrypted archives
AlertEncrypted no
AlertEncryptedArchive no
AlertEncryptedDoc no

# Alert on OLE2 macros
AlertOLE2Macros no

# Alert on partition intersection
AlertPartitionIntersection no
