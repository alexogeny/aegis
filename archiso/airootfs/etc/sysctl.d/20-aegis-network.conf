# Aegis Linux - Network Hardening Configuration
# =============================================================================
# These settings harden the TCP/IP stack against various network attacks
# and enhance privacy.
# =============================================================================

# -----------------------------------------------------------------------------
# SYN Flood Protection
# -----------------------------------------------------------------------------
# Enable TCP SYN cookies to prevent SYN flood attacks
net.ipv4.tcp_syncookies = 1

# Maximum number of remembered connection requests
net.ipv4.tcp_max_syn_backlog = 2048

# Number of times SYNACKs for passive TCP connection are retransmitted
net.ipv4.tcp_synack_retries = 2

# Number of times initial SYNs are retransmitted
net.ipv4.tcp_syn_retries = 5

# -----------------------------------------------------------------------------
# TCP Hardening
# -----------------------------------------------------------------------------
# Enable RFC 1337 fix (TIME-WAIT assassination protection)
net.ipv4.tcp_rfc1337 = 1

# Disable TCP SACK (can be exploited, small performance impact)
# Uncomment if you want maximum security over performance
# net.ipv4.tcp_sack = 0

# Enable TCP Fast Open (improves performance while maintaining security)
net.ipv4.tcp_fastopen = 3

# Enable TCP MTU probing for better performance over VPNs and tunnels
# 0 = Disabled
# 1 = Enabled when ICMP blackhole detected
# 2 = Always enabled
net.ipv4.tcp_mtu_probing = 1

# -----------------------------------------------------------------------------
# Source Routing Protection
# -----------------------------------------------------------------------------
# Disable source routing (prevents IP spoofing)
net.ipv4.conf.all.accept_source_route = 0
net.ipv4.conf.default.accept_source_route = 0
net.ipv6.conf.all.accept_source_route = 0
net.ipv6.conf.default.accept_source_route = 0

# -----------------------------------------------------------------------------
# ICMP Redirect Protection
# -----------------------------------------------------------------------------
# Do not accept ICMP redirects (prevents MITM attacks)
net.ipv4.conf.all.accept_redirects = 0
net.ipv4.conf.default.accept_redirects = 0
net.ipv6.conf.all.accept_redirects = 0
net.ipv6.conf.default.accept_redirects = 0

# Do not accept secure ICMP redirects
net.ipv4.conf.all.secure_redirects = 0
net.ipv4.conf.default.secure_redirects = 0

# Do not send ICMP redirects (not a router)
net.ipv4.conf.all.send_redirects = 0
net.ipv4.conf.default.send_redirects = 0

# -----------------------------------------------------------------------------
# Reverse Path Filtering
# -----------------------------------------------------------------------------
# Enable strict reverse path filtering (anti-spoofing)
# 0 = No validation
# 1 = Strict mode (recommended for single-homed hosts)
# 2 = Loose mode (for multi-homed hosts)
net.ipv4.conf.all.rp_filter = 1
net.ipv4.conf.default.rp_filter = 1

# -----------------------------------------------------------------------------
# ICMP Hardening
# -----------------------------------------------------------------------------
# Ignore ICMP echo requests to broadcast addresses (Smurf attack protection)
net.ipv4.icmp_echo_ignore_broadcasts = 1

# Ignore bogus ICMP error responses
net.ipv4.icmp_ignore_bogus_error_responses = 1

# Rate limit ICMP
net.ipv4.icmp_ratelimit = 100
net.ipv4.icmp_ratemask = 88089

# -----------------------------------------------------------------------------
# IPv6 Hardening
# -----------------------------------------------------------------------------
# Disable IPv6 router advertisements (prevents rogue RA attacks)
net.ipv6.conf.all.accept_ra = 0
net.ipv6.conf.default.accept_ra = 0

# Disable IPv6 router solicitations
net.ipv6.conf.all.router_solicitations = 0
net.ipv6.conf.default.router_solicitations = 0

# Do not accept IPv6 router preferences
net.ipv6.conf.all.accept_ra_rtr_pref = 0
net.ipv6.conf.default.accept_ra_rtr_pref = 0

# Do not learn prefix info from router advertisements
net.ipv6.conf.all.accept_ra_pinfo = 0
net.ipv6.conf.default.accept_ra_pinfo = 0

# Do not accept hop limit settings from RA
net.ipv6.conf.all.accept_ra_defrtr = 0
net.ipv6.conf.default.accept_ra_defrtr = 0

# Disable IPv6 autoconfiguration
net.ipv6.conf.all.autoconf = 0
net.ipv6.conf.default.autoconf = 0

# Uncomment to disable IPv6 entirely (if not needed)
# net.ipv6.conf.all.disable_ipv6 = 1
# net.ipv6.conf.default.disable_ipv6 = 1

# -----------------------------------------------------------------------------
# Privacy Enhancements
# -----------------------------------------------------------------------------
# Disable TCP timestamps (prevents uptime disclosure)
# Note: May affect TCP performance slightly
net.ipv4.tcp_timestamps = 0

# Use privacy extensions for IPv6 addresses
net.ipv6.conf.all.use_tempaddr = 2
net.ipv6.conf.default.use_tempaddr = 2

# -----------------------------------------------------------------------------
# Connection Tracking
# -----------------------------------------------------------------------------
# Increase conntrack table size for busy systems
net.netfilter.nf_conntrack_max = 131072

# Timeout for established connections
net.netfilter.nf_conntrack_tcp_timeout_established = 432000

# -----------------------------------------------------------------------------
# Logging
# -----------------------------------------------------------------------------
# Log Martian packets (impossible addresses)
net.ipv4.conf.all.log_martians = 1
net.ipv4.conf.default.log_martians = 1

# -----------------------------------------------------------------------------
# IP Forwarding (disabled for desktop use)
# -----------------------------------------------------------------------------
# Disable IP forwarding (not a router)
net.ipv4.ip_forward = 0
net.ipv6.conf.all.forwarding = 0

# If you need forwarding for VMs/containers, enable selectively:
# net.ipv4.ip_forward = 1
