# Aegis Linux - Post-Install Shell Process
# SPDX-FileCopyrightText: no
# SPDX-License-Identifier: CC0-1.0

# Run commands in chroot after installation
dontChroot: false
timeout: 600

# Post-installation commands
script:
    # Rebuild initramfs with NVIDIA modules
    - command: "mkinitcpio -P"
      timeout: 300

    # Generate locales
    - command: "locale-gen"
      timeout: 60

    # Update GRUB
    - command: "grub-mkconfig -o /boot/grub/grub.cfg"
      timeout: 120

    # Enable and configure AppArmor
    - command: "systemctl enable apparmor.service"
      timeout: 30

    # Enable audit daemon
    - command: "systemctl enable auditd.service"
      timeout: 30

    # Enable firewall
    - command: "systemctl enable nftables.service"
      timeout: 30

    # Enable SDDM
    - command: "systemctl enable sddm.service"
      timeout: 30

    # Enable NetworkManager
    - command: "systemctl enable NetworkManager.service"
      timeout: 30

    # Enable Bluetooth
    - command: "systemctl enable bluetooth.service"
      timeout: 30

    # Enable Docker
    - command: "systemctl enable docker.service"
      timeout: 30

    # Set AppArmor profiles to complain mode initially
    # This allows users to test before enforcing
    - command: "aa-complain /etc/apparmor.d/*"
      timeout: 60

    # Create Screenshots directory for user
    - command: "mkdir -p /home/*/Pictures/Screenshots"
      timeout: 10

    # Fix permissions
    - command: "chown -R 1000:1000 /home/*"
      timeout: 30

    # Update font cache
    - command: "fc-cache -fv"
      timeout: 60
