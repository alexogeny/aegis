# Aegis Linux - Security Limits Configuration
# =============================================================================
# Set resource limits for enhanced security and runaway process prevention
# =============================================================================

# -----------------------------------------------------------------------------
# Core Dumps (Security)
# -----------------------------------------------------------------------------
# Disable core dumps to prevent sensitive data leakage
*               hard    core            0
*               soft    core            0
root            hard    core            0

# -----------------------------------------------------------------------------
# Process Limits (Fork Bomb Prevention)
# -----------------------------------------------------------------------------
# Limit number of processes per user
*               soft    nproc           2048
*               hard    nproc           4096
root            soft    nproc           unlimited
root            hard    nproc           unlimited

# Limit for system users (more restrictive)
@nobody         hard    nproc           64

# -----------------------------------------------------------------------------
# Memory Limits
# -----------------------------------------------------------------------------
# Limit max locked memory (for regular users)
*               soft    memlock         65536
*               hard    memlock         262144

# Allow more for audio users (needed for real-time audio with PipeWire/JACK)
@audio          soft    memlock         unlimited
@audio          hard    memlock         unlimited

# Allow more for video group (needed for GPU work)
@video          soft    memlock         unlimited
@video          hard    memlock         unlimited

# Limit address space per process (prevents memory hogs)
# 16GB limit - prevents runaway processes from consuming all RAM
*               hard    as              17179869184

# Limit max data segment size
*               hard    data            8589934592

# Limit stack size
*               soft    stack           8192
*               hard    stack           65536

# -----------------------------------------------------------------------------
# File Limits
# -----------------------------------------------------------------------------
# Limit max file size (prevent disk filling attacks)
# 10GB limit - adjust as needed for your use case
*               hard    fsize           10737418240

# Limit number of open files
*               soft    nofile          4096
*               hard    nofile          65536
root            soft    nofile          65536
root            hard    nofile          65536

# Docker/containers may need higher limits
@docker         soft    nofile          65536
@docker         hard    nofile          524288

# -----------------------------------------------------------------------------
# CPU Time Limits
# -----------------------------------------------------------------------------
# Maximum CPU time in seconds (prevents infinite loops eating CPU)
# Commented out as it can break legitimate long-running processes
# Uncomment for high-security environments
# *               hard    cpu             3600

# -----------------------------------------------------------------------------
# Real-Time and Nice Priority
# -----------------------------------------------------------------------------
# Real-time priority for audio group (for low-latency audio)
@audio          soft    rtprio          95
@audio          hard    rtprio          99

# Nice priority for audio
@audio          soft    nice            -19
@audio          hard    nice            -20

# Allow wheel group some nice adjustment
@wheel          soft    nice            -5
@wheel          hard    nice            -10

# -----------------------------------------------------------------------------
# Pending Signals
# -----------------------------------------------------------------------------
# Limit pending signals per user (prevents signal queue exhaustion)
*               soft    sigpending      16384
*               hard    sigpending      32768

# -----------------------------------------------------------------------------
# Message Queue Limits
# -----------------------------------------------------------------------------
*               soft    msgqueue        819200
*               hard    msgqueue        1638400

# -----------------------------------------------------------------------------
# Maximum File Locks
# -----------------------------------------------------------------------------
*               soft    locks           unlimited
*               hard    locks           unlimited
