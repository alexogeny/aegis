---
import BaseLayout from "../layouts/BaseLayout.astro";
import Header from "../components/Header.astro";
import Footer from "../components/Footer.astro";

const envVariables = [
  {
    name: "LIBVA_DRIVER_NAME",
    value: "nvidia",
    desc: "VA-API driver selection",
  },
  { name: "GBM_BACKEND", value: "nvidia-drm", desc: "GBM backend for Wayland" },
  { name: "__GLX_VENDOR_LIBRARY_NAME", value: "nvidia", desc: "GLX vendor" },
  {
    name: "WLR_NO_HARDWARE_CURSORS",
    value: "1",
    desc: "Software cursors for stability",
  },
  { name: "NVD_BACKEND", value: "direct", desc: "Direct rendering mode" },
  {
    name: "ELECTRON_OZONE_PLATFORM_HINT",
    value: "auto",
    desc: "Electron Wayland hint",
  },
];

const supportedCards = [
  {
    series: "RTX 50 Series",
    models: ["5090", "5080", "5070 Ti", "5070"],
    status: "Supported",
    notes: "Latest generation, full support",
  },
  {
    series: "RTX 40 Series",
    models: ["4090", "4080", "4070 Ti", "4070", "4060 Ti", "4060"],
    status: "Supported",
    notes: "Excellent support",
  },
  {
    series: "RTX 30 Series",
    models: ["3090", "3080", "3070", "3060 Ti", "3060", "3050"],
    status: "Supported",
    notes: "Well tested",
  },
  {
    series: "RTX 20 Series",
    models: ["2080 Ti", "2080", "2070", "2060"],
    status: "Supported",
    notes: "Mature support",
  },
  {
    series: "GTX 16 Series",
    models: ["1660 Ti", "1660 Super", "1660", "1650"],
    status: "Supported",
    notes: "Turing architecture",
  },
];
---

<BaseLayout
  title="NVIDIA Support - Aegis Linux"
  description="Yes, NVIDIA just works on Aegis Linux. Open kernel modules, proper Wayland support, and all the right environment variables pre-configured."
>
  <Header />

  <main class="pt-24">
    <!-- Hero -->
    <section class="px-4 py-16 md:py-24">
      <div class="mx-auto max-w-6xl">
        <div class="text-center mb-12">
          <div class="text-6xl mb-6">üñ•Ô∏è</div>
          <h1 class="text-4xl md:text-5xl font-bold text-text mb-4">
            NVIDIA <span class="text-green">Just Works</span>
          </h1>
          <p class="text-xl text-subtext0 max-w-2xl mx-auto">
            We know the pain of NVIDIA on Linux. Aegis comes with open kernel
            modules, proper Wayland support, and all the right environment
            variables set.
          </p>
        </div>
      </div>
    </section>

    <!-- Features -->
    <section class="px-4 py-16 bg-mantle/50">
      <div class="mx-auto max-w-6xl">
        <div class="grid md:grid-cols-3 gap-8">
          <div class="bg-surface0/30 rounded-xl p-6 border border-surface0">
            <div
              class="w-12 h-12 rounded-lg bg-green/20 flex items-center justify-center text-green text-2xl mb-4"
            >
              üì¶
            </div>
            <h3 class="text-xl font-bold text-text mb-2">
              Open Kernel Modules
            </h3>
            <p class="text-subtext0 text-sm">
              Using nvidia-open-dkms for better stability and open source
              compliance. Automatically builds for your kernel.
            </p>
          </div>

          <div class="bg-surface0/30 rounded-xl p-6 border border-surface0">
            <div
              class="w-12 h-12 rounded-lg bg-green/20 flex items-center justify-center text-green text-2xl mb-4"
            >
              üé¨
            </div>
            <h3 class="text-xl font-bold text-text mb-2">
              Hardware Acceleration
            </h3>
            <p class="text-subtext0 text-sm">
              VA-API and VDPAU pre-configured for hardware video decoding.
              Smooth playback for 4K and HDR content.
            </p>
          </div>

          <div class="bg-surface0/30 rounded-xl p-6 border border-surface0">
            <div
              class="w-12 h-12 rounded-lg bg-green/20 flex items-center justify-center text-green text-2xl mb-4"
            >
              üìπ
            </div>
            <h3 class="text-xl font-bold text-text mb-2">NVENC Encoding</h3>
            <p class="text-subtext0 text-sm">
              GPU-accelerated video encoding for OBS Studio and
              gpu-screen-recorder. Stream and record with minimal CPU usage.
            </p>
          </div>
        </div>
      </div>
    </section>

    <!-- Environment Variables -->
    <section class="px-4 py-16">
      <div class="mx-auto max-w-4xl">
        <div class="text-center mb-12">
          <h2 class="text-3xl font-bold text-text mb-4">
            Pre-configured <span class="text-green">Environment</span>
          </h2>
          <p class="text-subtext0">
            All the environment variables you need are already set system-wide
          </p>
        </div>

        <div
          class="bg-crust rounded-xl border border-surface0 overflow-hidden font-mono text-sm"
        >
          <div
            class="bg-surface0/50 px-4 py-2 flex items-center gap-2 border-b border-surface0"
          >
            <div class="flex gap-1.5">
              <div class="w-3 h-3 rounded-full bg-red/80"></div>
              <div class="w-3 h-3 rounded-full bg-yellow/80"></div>
              <div class="w-3 h-3 rounded-full bg-green/80"></div>
            </div>
            <span class="text-subtext0 text-xs ml-2"
              >/etc/environment.d/nvidia.conf</span
            >
          </div>
          <div class="p-4 space-y-2">
            {
              envVariables.map((env) => (
                <div class="flex flex-wrap items-start gap-2">
                  <span class="text-green">{env.name}</span>
                  <span class="text-overlay0">=</span>
                  <span class="text-yellow">"{env.value}"</span>
                  <span class="text-overlay0 text-xs ml-4"># {env.desc}</span>
                </div>
              ))
            }
          </div>
        </div>
      </div>
    </section>

    <!-- Supported Cards -->
    <section class="px-4 py-16 bg-mantle/50">
      <div class="mx-auto max-w-4xl">
        <div class="text-center mb-12">
          <h2 class="text-3xl font-bold text-text mb-4">
            Supported <span class="text-green">GPUs</span>
          </h2>
          <p class="text-subtext0">
            All modern NVIDIA GeForce and Quadro cards are supported
          </p>
        </div>

        <div class="space-y-4">
          {
            supportedCards.map((card) => (
              <div class="bg-surface0/30 rounded-xl p-4 border border-surface0">
                <div class="flex flex-wrap items-center justify-between gap-4">
                  <div>
                    <h3 class="text-lg font-bold text-text">{card.series}</h3>
                    <p class="text-sm text-subtext0">
                      {card.models.join(" ‚Ä¢ ")}
                    </p>
                  </div>
                  <div class="text-right">
                    <span class="inline-block bg-green/20 text-green text-xs font-medium px-3 py-1 rounded-full">
                      {card.status}
                    </span>
                    <p class="text-xs text-overlay0 mt-1">{card.notes}</p>
                  </div>
                </div>
              </div>
            ))
          }
        </div>

        <p class="text-center text-overlay0 text-sm mt-6">
          Older cards (GTX 10 series and earlier) may require the proprietary
          nvidia-dkms package instead of nvidia-open-dkms
        </p>
      </div>
    </section>

    <!-- Wayland Support -->
    <section class="px-4 py-16">
      <div class="mx-auto max-w-6xl">
        <div class="grid md:grid-cols-2 gap-12 items-center">
          <div>
            <span
              class="inline-block bg-green/20 text-green px-4 py-1 rounded-full text-sm font-medium mb-4"
            >
              Wayland Native
            </span>
            <h2 class="text-3xl font-bold text-text mb-4">
              Full <span class="text-green">Wayland Support</span>
            </h2>
            <p class="text-subtext0 mb-6">
              Hyprland compositor running natively on Wayland with NVIDIA GPU.
              No more Xwayland workarounds or compatibility layers needed for
              most apps.
            </p>
            <ul class="space-y-3 text-sm text-subtext0">
              <li class="flex items-center gap-2">
                <span class="text-green">‚úì</span>
                Direct scanout for gaming performance
              </li>
              <li class="flex items-center gap-2">
                <span class="text-green">‚úì</span>
                VRR/G-Sync support
              </li>
              <li class="flex items-center gap-2">
                <span class="text-green">‚úì</span>
                HDR passthrough (where supported)
              </li>
              <li class="flex items-center gap-2">
                <span class="text-green">‚úì</span>
                Electron apps in Wayland mode
              </li>
              <li class="flex items-center gap-2">
                <span class="text-green">‚úì</span>
                Firefox and Chromium native Wayland
              </li>
            </ul>
          </div>

          <div class="bg-surface0/30 rounded-xl p-6 border border-surface0">
            <h3 class="text-lg font-bold text-text mb-4">Quick Test</h3>
            <div class="bg-crust rounded-lg p-4 font-mono text-sm space-y-3">
              <div>
                <span class="text-overlay0">$ </span>
                <span class="text-text">glxinfo | grep "OpenGL renderer"</span>
              </div>
              <div class="text-green">
                OpenGL renderer string: NVIDIA GeForce RTX 4090/PCIe/SSE2
              </div>
              <div class="mt-4">
                <span class="text-overlay0">$ </span>
                <span class="text-text"
                  >nvidia-smi --query-gpu=name --format=csv</span
                >
              </div>
              <div class="text-green">
                name<br />
                NVIDIA GeForce RTX 4090
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Troubleshooting -->
    <section class="px-4 py-16 bg-mantle/50">
      <div class="mx-auto max-w-4xl">
        <div class="text-center mb-12">
          <h2 class="text-3xl font-bold text-text mb-4">
            Common <span class="text-yellow">Questions</span>
          </h2>
        </div>

        <div class="space-y-4">
          <div class="bg-surface0/30 rounded-xl p-6 border border-surface0">
            <h3 class="text-lg font-bold text-text mb-2">
              Do I need to install drivers manually?
            </h3>
            <p class="text-subtext0 text-sm">
              No. Aegis detects NVIDIA hardware during installation and installs
              the appropriate drivers (nvidia-open-dkms) automatically.
            </p>
          </div>

          <div class="bg-surface0/30 rounded-xl p-6 border border-surface0">
            <h3 class="text-lg font-bold text-text mb-2">
              What about hybrid graphics (laptops)?
            </h3>
            <p class="text-subtext0 text-sm">
              PRIME render offload is configured automatically. Use
              <code class="text-mauve font-mono">prime-run</code> to run specific
              apps on the NVIDIA GPU.
            </p>
          </div>

          <div class="bg-surface0/30 rounded-xl p-6 border border-surface0">
            <h3 class="text-lg font-bold text-text mb-2">
              Can I use CUDA and machine learning frameworks?
            </h3>
            <p class="text-subtext0 text-sm">
              Yes. CUDA toolkit and cuDNN are available in the Arch
              repositories. Install them with
              <code class="text-mauve font-mono">pacman -S cuda cudnn</code>.
            </p>
          </div>

          <div class="bg-surface0/30 rounded-xl p-6 border border-surface0">
            <h3 class="text-lg font-bold text-text mb-2">
              What if I have an older GPU?
            </h3>
            <p class="text-subtext0 text-sm">
              For GTX 10 series and older, you may need to switch to nvidia-dkms
              (closed source). Run
              <code class="text-mauve font-mono"
                >pacman -S nvidia-dkms nvidia-utils</code
              > and reboot.
            </p>
          </div>
        </div>
      </div>
    </section>

    <!-- CTA -->
    <section class="px-4 py-16">
      <div class="mx-auto max-w-4xl text-center">
        <h2 class="text-3xl font-bold text-text mb-4">
          Finally, NVIDIA on Linux Done Right
        </h2>
        <p class="text-subtext0 text-lg mb-8">
          Stop fighting drivers. Download Aegis and get to work.
        </p>
        <a
          href="/download"
          class="inline-block bg-green hover:bg-teal text-crust font-semibold px-10 py-4 rounded-lg transition-colors duration-200 text-xl"
        >
          Download Now
        </a>
      </div>
    </section>
  </main>

  <Footer />
</BaseLayout>
